{% load staticfiles %}
{% load humanize %}
{% load meals_extras %}

<div class="container-fluid m-auto">
<div method="post" action="{% url 'sales_projection' %}" id="projectionFilterForm">
{% csrf_token %}
<div class="row">
<div class="col-sm-3 my-2">
<h3>Filter</h3>
{% if form.non_field_errors %}
<div class="alert alert-danger">
    <p>Please correct the following error:</p>
    {{ form.non_field_errors }}
</div>
{% endif %}
<div class="form-group">
    <label for="{{ form.sku.id_for_label }}">Customer name:</label>
    {{ form.sku }}
    <small>{{ form.sku.help_text }}</small>
    {% if form.sku.errors %}
    <small>{{ form.sku.errors }}</small>
    {% endif %}
</div>
<div class="form-group">
    <label for="{{ form.start.id_for_label }}">Start date:</label>
    {{ form.start }}
    {% if form.start.errors %}
    <small>{{ form.start.errors }}</small>
    {% endif %}
</div>
<div class="form-group">
    <label for="{{ form.end.id_for_label }}">End date:</label>
    {{ form.end }}
    {% if form.end.errors %}
    <small>{{ form.end.errors }}</small>
    {% endif %}
</div>
<div>
</div>
</div>


<!-- Table column -->
<div class="col-sm-9 my-2">
{% if messages %}
<div class="alert alert-success" id="messagesDiv">
{% for message in messages %}
<p {% if message.tags %}class="{{ message.tags }}{% endif %}">{{ message }}</p>
{% endfor %}
</div>
{% endif %}

<h3 class="mb-3">Sales Projection for SKU #{{ sku.number }}: {{ sku.name }}</h3>

<div style="overflow: scroll;">
        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th>Four Year Average</th>
                    <th>Standard Deviation</th>
                </tr>
            </thead>
            <tbody>
            <tr>
                <td class="align-middle" id="avgValue">
                    {{ avg }}
                </td>
                <td class="align-middle">
                    {{ std }}
                </td>
            </tr>
            </tbody>
        </table>
        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th>Year</th>
                    <th>Sales</th>
                </tr>
            </thead>
            <tbody>
                {% for year, sales in data.items %}
                    <tr>
                        <td class="align-middle">
                            {{ year }}
                        </td>
                        <td class="align-middle">
                            {{ sales }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
</div>
    <!-- Modals here if needed -->


<!-- Hidden div with template data -->
<div style="display: none;">
    <a href="{{ sku.number }}" id="sku_number"></a>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="{% static 'meals/common.js' %}"></script>
<script src="{% static 'meals/sku/sku.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script src="{% static 'meals/sales/drilldown.js' %}"></script>
